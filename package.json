{
  "name": "voice-prompt",
  "displayName": "Voice Prompt",
  "description": "Capture voice, rewrite into clean prompts, and inject into VS Code / Cursor input.",
  "version": "0.1.0",
  "publisher": "bread22",
  "engines": {
    "vscode": "^1.90.0"
  },
  "categories": [
    "Other"
  ],
  "main": "./dist/extension.js",
  "activationEvents": [
    "onCommand:voicePrompt.startRecording",
    "onCommand:voicePrompt.setCloudApiKey"
  ],
  "contributes": {
    "commands": [
      {
        "command": "voicePrompt.startRecording",
        "title": "Voice Prompt: Start Recording"
      },
      {
        "command": "voicePrompt.setCloudApiKey",
        "title": "Voice Prompt: Set Cloud API Key"
      }
    ],
    "keybindings": [
      {
        "command": "voicePrompt.startRecording",
        "key": "alt+v",
        "when": ""
      }
    ],
    "configuration": {
      "title": "Voice Prompt",
      "properties": {
        "voicePrompt.stt.provider": {
          "type": "string",
          "default": "whisper-cpp",
          "enum": ["whisper-cpp", "http"],
          "enumDescriptions": [
            "Local whisper-cpp CLI (recommended, no server needed)",
            "HTTP endpoint (for custom STT servers)"
          ],
          "description": "Speech-to-text provider."
        },
        "voicePrompt.stt.model": {
          "type": "string",
          "default": "tiny.en",
          "enum": ["tiny.en", "tiny", "base.en", "base", "small.en", "small"],
          "description": "Whisper model size. Smaller = faster, larger = more accurate."
        },
        "voicePrompt.stt.whisperCppPath": {
          "type": "string",
          "default": "",
          "description": "Path to whisper-cpp binary. Leave empty to auto-detect from PATH."
        },
        "voicePrompt.stt.modelPath": {
          "type": "string",
          "default": "",
          "description": "Path to GGML model file. Leave empty to auto-download."
        },
        "voicePrompt.stt.httpEndpoint": {
          "type": "string",
          "default": "http://127.0.0.1:8765/transcribe",
          "description": "HTTP STT endpoint (used when provider is 'http')."
        },
        "voicePrompt.stt.timeoutMs": {
          "type": "number",
          "default": 30000,
          "minimum": 5000,
          "maximum": 120000,
          "description": "STT timeout in milliseconds."
        },
        "voicePrompt.stt.language": {
          "type": "string",
          "default": "en",
          "description": "Language code for speech recognition."
        },
        "voicePrompt.rewrite.provider": {
          "type": "string",
          "default": "ollama",
          "enum": ["ollama", "cloud", "none"],
          "description": "Rewrite provider."
        },
        "voicePrompt.rewrite.model": {
          "type": "string",
          "default": "llama3.2:3b",
          "description": "Rewrite model identifier."
        },
        "voicePrompt.rewrite.cloudBaseUrl": {
          "type": "string",
          "default": "https://api.openai.com/v1/chat/completions",
          "description": "Cloud rewrite API endpoint (OpenAI-compatible)."
        },
        "voicePrompt.rewrite.ollamaBaseUrl": {
          "type": "string",
          "default": "http://127.0.0.1:11434",
          "description": "Ollama base URL."
        },
        "voicePrompt.rewrite.timeoutMs": {
          "type": "number",
          "default": 20000,
          "minimum": 1000,
          "maximum": 120000,
          "description": "Rewrite request timeout in milliseconds."
        },
        "voicePrompt.rewrite.style": {
          "type": "string",
          "default": "engineering",
          "enum": ["concise", "detailed", "engineering", "debugging"],
          "description": "Rewrite style preset."
        },
        "voicePrompt.previewBeforeInsert": {
          "type": "boolean",
          "default": false,
          "description": "Show editable preview before insertion."
        },
        "voicePrompt.autoFallbackToCloud": {
          "type": "boolean",
          "default": false,
          "description": "Fallback to cloud provider if local rewrite fails."
        },
        "voicePrompt.noRewriteBehavior": {
          "type": "string",
          "default": "stt_passthrough",
          "enum": ["stt_passthrough", "disable_plugin"],
          "description": "Behavior when no rewrite backend is available."
        },
        "voicePrompt.showStatusBarButton": {
          "type": "boolean",
          "default": true,
          "description": "Show status bar microphone button."
        },
        "voicePrompt.insertTrailingSpace": {
          "type": "boolean",
          "default": true,
          "description": "Append a space after inserted text for easier consecutive inputs."
        },
        "voicePrompt.vad.enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable VAD auto-end behavior."
        },
        "voicePrompt.vad.silenceMs": {
          "type": "number",
          "default": 1500,
          "minimum": 600,
          "maximum": 3000,
          "description": "Silence duration (ms) before auto-stop. Increase if speech is cut off."
        },
        "voicePrompt.vad.minSpeechMs": {
          "type": "number",
          "default": 300,
          "minimum": 100,
          "maximum": 1000,
          "description": "Minimum speech duration to accept input."
        }
      }
    }
  },
  "scripts": {
    "build": "tsc -p .",
    "bundle": "node esbuild.mjs --production",
    "bundle:dev": "node esbuild.mjs",
    "package": "npm run bundle && npx vsce package --no-dependencies --skip-license --allow-missing-repository",
    "dev": "node esbuild.mjs && npx vsce package --no-dependencies --skip-license --allow-missing-repository -o voice-prompt-dev.vsix",
    "watch": "tsc -w -p .",
    "test": "npm run build && node test/runTests.js"
  },
  "devDependencies": {
    "@types/node": "^22.13.10",
    "@types/vscode": "^1.90.0",
    "@vscode/vsce": "^2.32.0",
    "esbuild": "^0.25.0",
    "typescript": "^5.8.2"
  },
  "dependencies": {
    "undici": "^7.5.0"
  }
}
